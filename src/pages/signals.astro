---
import BaseLayout from '../layouts/BaseLayout.astro';
import Footer from '../components/Footer.astro';
import { getCollection, render } from 'astro:content';

const signals = await getCollection('signals');
const sortedSignals = signals.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Pre-render content
const renderedSignals = await Promise.all(sortedSignals.map(async (signal) => {
    const { Content } = await render(signal);
    return {
        ...signal,
        Content
    };
}));
---

<BaseLayout title="Signals | Digital Wilderness">
    
    <main class="min-h-screen pt-32 px-[max(5vw,20px)] max-w-3xl mx-auto">
        
        <header class="mb-24 text-center">
            <h1 class="font-serif text-[clamp(2.5rem,6vw,4rem)] italic text-[var(--text)] mb-4">
                Signals
            </h1>
            <p class="font-mono text-xs tracking-[0.2em] text-[var(--text-muted)] uppercase">
                Fragments & Vibrations
            </p>
            <p class="mt-4 text-sm text-[var(--text-secondary)] opacity-70">
                碎片化的思考与灵感
            </p>
        </header>

        <div class="relative space-y-12 pb-32">
            {renderedSignals.map((signal) => (
                <article class="relative pl-8 md:pl-12 group">
                    <!-- Timeline Dot -->
                    <div class="absolute left-0 top-2 w-3 h-3 rounded-full border border-[var(--text)] bg-[var(--bg)] group-hover:bg-[var(--accent)] group-hover:border-[var(--accent)] transition-colors z-10"></div>
                    <!-- Timeline Line -->
                    <div class="absolute left-[5px] top-5 bottom-[-48px] w-[1px] bg-[var(--grid-line)] last:hidden"></div>

                    <!-- Date -->
                    <div class="font-mono text-xs text-[var(--text-muted)] mb-3 flex items-center gap-3">
                        {signal.data.pubDate.toLocaleDateString('zh-CN', { month: 'long', day: 'numeric', year: 'numeric' })}
                        {signal.data.tags.map(tag => (
                            <span class="opacity-50">#{tag}</span>
                        ))}
                    </div>

                    <!-- Content Card -->
                    <div class="bg-white/40 dark:bg-white/5 backdrop-blur-sm border border-white/60 dark:border-white/10 p-6 rounded-[var(--radius-lg)] shadow-sm hover:shadow-[var(--shadow-warm)] transition-shadow">
                        <div class="prose prose-stone max-w-none prose-p:text-[var(--text)] prose-p:leading-relaxed prose-p:my-0">
                            <signal.Content />
                        </div>
                    </div>
                </article>
            ))}
            
            {renderedSignals.length === 0 && (
                <div class="text-center opacity-50 font-mono text-sm py-12">
                    暂无信号。
                </div>
            )}
        </div>

    </main>

    <Footer />
</BaseLayout>
